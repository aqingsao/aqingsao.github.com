---
layout: post
title: "日志分析工具的用处"
description: ""
category: Agile
tags: [Agile, Test Coverage]
---
系统上线好几天了，突然收到客户的紧急邮件，说是邮件发送功能有问题，预期每天发送一次，但现在每5分钟发送一次。这意味着客户会给他们的客户最快每5分钟发送一次邮件，后果很严重...  
我的第一反应当然是怎么可能呢？  
每天发送邮件的功能，原来hardcode到代码里，每天只会发送一次。后来为了方便测试，就把发送间隔改成了可配置项，上周刚刚上线。当然，默认值肯定是每天发送一次。

是不是生产环境的配置项出现了错误？于是检查了发布版本的代码和配置文件，结果没问题。在本地部署了一个版本，测试也发现没问题。

是不是客户搞错了？有没有可能UAT环境错误地发送了邮件？再次确认，客户肯定地说是LIVE环境，没错。

无法访问LIVE环境，只剩下一招了，向客户要一些日志吧。等待时（分布式异地开发就是麻烦，等待、等待……），同事提醒说客户有日志分析工具Splunk可以访问，从上面可以找到蛛丝马迹。于是登陆，根据关键字去搜索，结果很让我激动：
<a href="/assets/images/log-analysis.png">
	<img src="/assets/images/log-analysis.png" style="width:100%;" title="Splunk result" class="alignnone size-medium wp-image-17">
</a>

从系统上线的一周内，可以发现，邮件是每天发送一次，而且发送时间、数量都是对的！
这是个有力的证据，LIVE环境根本没有问题！

问题解决了，这是一个很好的例子，生产环境的日志分析工具可以把运维数据进行索引，并通过应用的方式暴露出来，对生产环境的错误定位帮助非常大：  
* 生产环境的日志不是很容易得到，日志分析工具用WEB把数据暴露出来，避免了安全问题。  
* 友好的呈现方式：不需要从海量的日志文件中搜索，日志分析工具已经做了索引，速度快，而且更容易得到关心的信息，比如出现时间、频率、数量。  
* 对运维人员来说，日志分析工具提供很多运维信息：特定的错误（比如网站4××错误；Web服务器的错误…），根据错误信息及时告警。  

嗯，在生产环境，日志分析工具会是很好的帮手。